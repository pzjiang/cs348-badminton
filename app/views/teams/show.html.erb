<style>
    body {
      background-image: url('https://img.freepik.com/free-vector/pastel-abstract-nebula_91008-229.jpg?w=2000');
    }
</style>

<h1> Team Page</h1>
<%= link_to "Back to teams", "/teams/"%> <br>
<%= link_to "Home", "/"%>
<br>
<h3>Team Name: <%= @team.name %> </h3>
<h4>Location: <%= @team.location %></h4>

<br>

<h3> Member List: </h3>
<hr>
<ul>
<% @members.each do |member| %>
    <li>
    <b>
        <%= link_to member.username, member %> </b> <br>
        <%= member.email %> <br>
    </li>
<% end %>
</ul>
<hr>

<% if current_user.team_id == @team.id%>
    <h3>Messages: </h3>
    <ul>
    <% @messages.each do |message| %>
        <li>
            <b><%= message.body%> <br></b>
            Message Status: <%= message.status %> <br>
            Sender ID: <%= message.user_id%> <br>
            Sent at <%= message.created_at %> <br>
        </li>
    <% end %>
    </ul>
    <%= link_to 'Send a new message', new_message_path, class:"btn btn-secondary"%>



    <h3>Practice List:</h3>

    <%= @practices.each do |practice| %>
        <b>
            <%= practice.date %><br>
            <%= practice.location %> <br>
        </b>
    <% end %>
    <%= link_to "Add Practice", new_practice_path %>

<%end%>

<% if current_user.team_id != @team.id %>

    Request to join this team <%= @team.name %>

    <%= form_with(model: @join_req) do |form| %>
    <% if @join_req.errors.any? %>
        <div id="error_explanation">
        <h2><%= pluralize(@join_req.errors.count, "error") %> prohibited this join req from being saved:</h2>

        <ul>
            <% @join_req.errors.each do |error| %>
            <li><%= error.full_message %></li>
            <% end %>
        </ul>
        </div>
    <% end %>

    <br>

    <div class="field form-group" >
        <%# <%= form.text_field :body, class:"form-control", placeholder:"Join request Body"%>
        <%= form.hidden_field :user_id, value: current_user.id%>
        <%= form.hidden_field :req_name, value: current_user.email%>
        <%= form.hidden_field :status, value: "Pending"%>
        <%= form.hidden_field :req_role, value: "Player"%>
        <%= form.hidden_field :team_id, value: @team.id%>
        <%= form.hidden_field :status, value: "Sent"%>
    </div>


    <br>

        <div>
            <%= form.submit "Request to join", class:"btn btn-primary" %>
        </div>


    <% end %>
<%end%>

<% if current_user.role == "System Admin" || current_user.role == "Team Admin"%>
    <%@join_reqs.each do |ind|%>
        <%if ind.status == "Pending"%>
            <%= ind.req_name%> would like to join your team
            <br>
            <%= form_with scope: :patch, url: :join_accept do |form| %>
                <%= form.hidden_field :user_id, value: ind.user_id %>
                <%= form.hidden_field :team_id, value: @team.id%>
                <%= form.hidden_field :id, value: ind.id%>
                <%= form.hidden_field :status, value: "Accept"%>
                <input name="_method" type="hidden" value="put" />
                <%= form.submit "Accept" %>
            <%end%>
            <br>
            <%= form_with scope: :patch, url: :join_accept do |form| %>
                <%= form.hidden_field :user_id, value: ind.user_id %>
                <%= form.hidden_field :team_id, value: @team.id%>
                <%= form.hidden_field :id, value: ind.id%>
                <%= form.hidden_field :status, value: "Reject"%>
                <input name="_method" type="hidden" value="put" />
                <%= form.submit "Reject" %>
            <%end%>
        <%end%>
    <%end%>
<%end%>

